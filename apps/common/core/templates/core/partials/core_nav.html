{% comment %} templates/core/partials/core_nav.html {% endcomment %}

{% load static i18n %}

<nav class="topnav navbar navbar-expand shadow justify-content-between justify-content-sm-start navbar-light bg-white container rounded mt-5" id="sidenavAccordion">
  <!-- Sidenav Toggle Button (SM only) -->
  <button data-bs-target="#offcanvasDarkNavbar" data-bs-toggle="offcanvas" id="sidebarToggle" type="button" aria-controls="offcanvasDarkNavbar" aria-expanded="false" aria-label="Toggle navigation" class="btn btn-icon btn-transparent-dark order-1 order-lg-0 me-2 ms-lg-2 me-lg-0 d-md-none"><i data-feather="menu"></i></button>

  {% include 'partials/nav/logo.html' %}

  {# ======== BOTONES CENTRALES en DESKTOP (MD+): ocultos en SM ======== #}
  {% if request.user.is_authenticated %}
    <div class="d-none d-md-flex flex-grow-1 justify-content-center gap-2">
      {% if request.user.is_buyer or request.user.is_superuser or perms.users.can_view_buyer %}
        <a href="{% url 'buyers:buyer_index' %}" class="btn text-black fw-semibold gea_gradient">{% trans 'Buyer' %}</a>
      {% endif %}

      {% if request.user.is_asset_holder or request.user.is_superuser or perms.users.can_view_holder %}
        <a href="{% url 'assets:holder_index' %}" class="btn text-black fw-semibold gea_gradient">{% trans 'Client Area' %}</a>
      {% endif %}
    </div>
  {% else %}
    <div class="d-none d-md-flex flex-grow-1 justify-content-center">
      <a href="{% url 'assets:holder_index' %}" class="btn text-black fw-semibold gea_gradient">
        {% trans 'On-demand offers' %}
      </a>
    </div>
  {% endif %}

  <!-- Navbar Items (derecha) -->
  <ul class="navbar-nav align-items-center ms-auto">
    {% include 'partials/nav/language_selector.html' %}

    {# ======== BOTONES LOGIN / REGISTER en DESKTOP (MD+): ocultos en SM ======== #}
    {% if not request.user.is_authenticated %}
      <li class="nav-item me-2 d-none d-md-block">
        <a class="btn btn-outline-success text-capitalize" href="{% url 'two_factor:login' %}">{% trans 'Login' %}</a>
      </li>
      <li class="nav-item me-3 d-none d-md-block">
        <a class="btn btn-outline-warning text-capitalize" href="{% url 'account:register' %}">{% trans 'Register' %}</a>
      </li>
    {% endif %}

    {% if request.user.is_authenticated %}
      {% include 'partials/nav/user_dropdown.html' %}
    {% endif %}
  </ul>
</nav>

{# ======== COLLAPSE SM: aquí aparecen los botones que en MD+ van fuera ======== #}
<nav class="navbar navbar-dark bg-dark d-md-none">
  <div class="offcanvas offcanvas-end text-bg-dark" id="offcanvasDarkNavbar" tabindex="-1">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title text-white" id="offcanvasDarkNavbarLabel">{% trans 'Menu' %}</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>

    <div class="offcanvas-body">
      <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-translate mx-1"></i> {% trans 'Language' %}</a>

          <ul class="dropdown-menu dropdown-menu-dark">
            {% for lang in LANGUAGES %}
              <li>
                <a class="dropdown-item" href="{% url 'utils:set_language' %}?lang={{ lang.0 }}"><i class="bi bi-globe-americas me-3"></i> {{ lang.1 }}</a>
              </li>
            {% endfor %}
          </ul>
        </li>
      </ul>
    </div>

    <div class="offcanvas-body">
      {# ======== LANGUAGE SELECTOR para SM ======== #}
      <div class="w-100 d-flex flex-column gap-2">
        {# ======== BOTONES CENTRALES (solo autenticado) para SM ======== #}
        {% if request.user.is_authenticated %}
          {% if request.user.is_buyer or request.user.is_superuser or perms.users.can_view_buyer %}
            <a href="{% url 'buyers:buyer_index' %}" class="btn btn-light text-black fw-semibold gea_gradient w-100">{% trans 'Buyer' %}</a>
          {% endif %}

          {% if request.user.is_asset_holder or request.user.is_superuser or perms.users.can_view_holder %}
            <a href="{% url 'assets:holder_index' %}" class="btn btn-light text-black fw-semibold gea_gradient w-100">{% trans 'Client Area' %}</a>
          {% endif %}
        {% endif %}

        {# ======== BOTONES LOGIN / REGISTER (solo NO autenticado) para SM ======== #}
        {% if not request.user.is_authenticated %}
          <a class="btn btn-outline-success text-capitalize w-100" href="{% url 'two_factor:login' %}">{% trans 'Login' %}</a>
          <a class="btn btn-outline-warning text-capitalize w-100" href="{% url 'account:register' %}">{% trans 'Register' %}</a>
        {% else %}
          {# ======== BOTÓN LOGOUT (solo autenticado) para SM ======== #}
          <a class="btn btn-outline-danger text-capitalize w-100" href="{% url 'account:logout' %}">{% trans 'Logout' %}</a>
        {% endif %}
      </div>
    </div>
  </div>
</nav>
