{% comment %} templates/core/partials/core_nav.html {% endcomment %}
{% load static i18n %}

{# ====================== DESKTOP NAV ====================== #}
<nav class="topnav navbar navbar-expand shadow justify-content-between justify-content-sm-start navbar-light bg-white container rounded mt-5"
     id="sidenavAccordion">

  <!-- Toggle (SM only) -->
  <button
    data-bs-target="#offcanvasDarkNavbar"
    data-bs-toggle="offcanvas"
    id="sidebarToggle"
    type="button"
    class="btn btn-icon btn-transparent-dark order-1 order-lg-0 me-2 ms-lg-2 me-lg-0 d-md-none"
    aria-controls="offcanvasDarkNavbar"
    aria-expanded="false"
    aria-label="{% trans 'Toggle navigation' %}">
    <i data-feather="menu"></i>
  </button>

  {% include 'partials/nav/logo.html' %}

  {# ======== CENTER BUTTONS (MD+) ======== #}
  <div class="d-none d-md-flex flex-grow-1 justify-content-center align-items-center gap-2">

    {# ===== Buyers / Suppliers ===== #}
    {% if request.user.is_authenticated %}
      {% if request.user.is_buyer or request.user.is_superuser or perms.users.can_view_buyer %}
        <a href="{% url 'buyers:buyer_index' %}"
           class="btn text-black fw-semibold gea_gradient"
           style="height: 40px;">
          {% trans 'Buyers' %}
        </a>
      {% endif %}

      {% if request.user.is_asset_holder or request.user.is_superuser or perms.users.can_view_holder %}
        <a href="{% url 'assets:holder_index' %}"
           class="btn text-black fw-semibold gea_gradient"
           style="height: 40px;">
          {% trans 'Suppliers' %}
        </a>
      {% endif %}
    {% endif %}

    {# ===== Certificates Dropdown (PUBLIC) ===== #}
    <div class="dropdown d-flex align-items-center">
      <button
        class="btn btn-outline-dark fw-semibold dropdown-toggle"
        type="button"
        id="certificatesDropdown"
        data-bs-toggle="dropdown"
        aria-expanded="false"
        style="height: 40px;">
        {% trans 'Certificates' %}
      </button>

      <ul class="dropdown-menu shadow-sm" aria-labelledby="certificatesDropdown">
        <li>
          <a class="dropdown-item"
             href="{% url 'certificates:certificates_landing' %}">
            <i class="bi bi-grid me-2"></i>
            {% trans 'Certificates' %}
          </a>
        </li>

        {% if request.user.is_authenticated and request.user.is_buyer %}
          <li><hr class="dropdown-divider"></li>
          <li>
            <a class="dropdown-item"
               href="https://geausa.propensionesabogados.com/aegis_certification_international_system_of_legal_verification.pdf"
               target="_blank" rel="noopener">
              <i class="bi bi-file-earmark-pdf me-2 text-danger"></i>
              {% trans 'AEGIS Certification (PDF)' %}
            </a>
          </li>
        {% endif %}
      </ul>
    </div>

    {# ===== External Logos ===== #}
    <a href="https://propensionesabogados.com/" target="_blank" rel="noopener">
      <img src="https://geausa.propensionesabogados.com/public/static/assets/imgs/logos/propensiones_h.webp"
           alt="Propensiones Abogados"
           style="height: 55px;" />
    </a>

    <a href="https://fundacionattlas.org/" target="_blank" rel="noopener">
      <img src="https://fundacionattlas.org/assets/imgs/page/logo h fundacion attlas.webp"
           alt="Fundación Attlas"
           style="height: 55px;" />
    </a>

  </div>

  {# ===== RIGHT SIDE ===== #}
  <ul class="navbar-nav align-items-center ms-auto">
    {% include 'partials/nav/language_selector.html' %}

    {% if not request.user.is_authenticated %}
      <li class="nav-item me-2 d-none d-md-block">
        <a class="btn btn-outline-success" href="">
          {% trans 'Login' %}
        </a>
      </li>
      <li class="nav-item me-3 d-none d-md-block">
        <a class="btn btn-outline-warning" href="">
          {% trans 'Register' %}
        </a>
      </li>
    {% else %}
      {% include 'partials/nav/user_dropdown.html' %}
    {% endif %}
  </ul>
</nav>

{# ====================== MOBILE OFFCANVAS ====================== #}
<nav class="navbar navbar-dark bg-dark d-md-none">
  <div class="offcanvas offcanvas-end text-bg-dark" id="offcanvasDarkNavbar" tabindex="-1">

    <div class="offcanvas-header">
      <h5 class="offcanvas-title">{% trans 'Menu' %}</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
    </div>

    <div class="offcanvas-body">

      <ul class="navbar-nav mb-3">

        {# Language #}
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
            <i class="bi bi-translate me-1"></i> {% trans 'Language' %}
          </a>
          <ul class="dropdown-menu dropdown-menu-dark">
            {% for lang in LANGUAGES %}
              <li>
                <a class="dropdown-item" href="{% url 'utils:set_language' %}?lang={{ lang.0 }}">
                  {{ lang.1 }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </li>

        {# Certificates (PUBLIC) #}
        <li class="nav-item dropdown mt-2">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
            <i class="bi bi-award me-1"></i> {% trans 'Certificates' %}
          </a>
          <ul class="dropdown-menu dropdown-menu-dark">
            <li>
              <a class="dropdown-item" href="{% url 'certificates:certificates_landing' %}">
                {% trans 'Certificates' %}
              </a>
            </li>
            {% if request.user.is_authenticated and request.user.is_buyer %}
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item"
                   href="https://geausa.propensionesabogados.com/aegis_certification_international_system_of_legal_verification.pdf"
                   target="_blank">
                  {% trans 'AEGIS Certification (PDF)' %}
                </a>
              </li>
            {% endif %}
          </ul>
        </li>

      </ul>

      <div class="d-flex flex-column gap-2">

        <a href="https://propensionesabogados.com/" target="_blank" class="btn btn-warning">
          Propensiones Abogados
        </a>

        <a href="https://fundacionattlas.org/" target="_blank" class="btn btn-info">
          Fundación Attlas
        </a>

        {% if request.user.is_authenticated %}
          {% if request.user.is_buyer %}
            <a href="{% url 'buyers:buyer_index' %}" class="btn btn-light">
              {% trans 'Buyers' %}
            </a>
          {% endif %}
          {% if request.user.is_asset_holder %}
            <a href="{% url 'assets:holder_index' %}" class="btn btn-light">
              {% trans 'Suppliers' %}
            </a>
          {% endif %}
          <a href="{% url 'account:logout' %}" class="btn btn-outline-danger">
            {% trans 'Logout' %}
          </a>
        {% else %}
          <a href="" class="btn btn-outline-success">
            {% trans 'Login' %}
          </a>
          <a href="" class="btn btn-outline-warning">
            {% trans 'Register' %}
          </a>
        {% endif %}

      </div>
    </div>
  </div>
</nav>
