{% extends 'dashboard/account/layout/account.html' %}

{% load static i18n %}

{% block layout_content %}
<div class="d-flex align-items-center justify-content-center container-xl px-5 min-vh-100">
  <div class="card mx-auto" style="max-width: 600px; width: 100%;">

    <div class="card-header text-center my-2">
      <a href="{% url 'core:index' %}">
        <img src="https://globalallianceusa.com/gea/public/static/assets/imgs/logos/gea_logo_gold.webp"
          class="card-img-top img-fluid" alt="GEA" />
      </a>
    </div>

    <div class="card-body">
      <form method="POST">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ next }}" />

        <!-- Display non-field errors -->
        {% if form.non_field_errors %}
        <div class="alert alert-danger" role="alert">
          {% for error in form.non_field_errors %}
          <p>{{ error }}</p>
          {% endfor %}
        </div>
        {% endif %}

        <div class="row g-3">
          {% with "dashboard/account/partials/_floating_input.html" as floating_input %}
          <div class="col-md-6">
            {% include floating_input with field=form.username label=_("Username") %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.email label=_("Email") %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.password label=_("Password") show_eye=True eye_target_id="register_password" %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.confirm_password label=_("Confirm Password") show_eye=True eye_target_id="register_confirm_password" %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.first_name label=_("First Names") %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.last_name label=_("Last Names") %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.user_type label=_("User Type") %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.unique_code label=_("Unique Code") show_eye=True eye_target_id="register_unique_code" %}
          </div>

          {% endwith %}
        </div>

        <div class="d-grid gap-2 mt-3">
          <button type="submit" class="btn btn-success">{% trans 'Register' %}</button>
          <a class="btn btn-outline-dark" href="{% url 'two_factor:login' %}">
            {% trans 'Do you already have an account? Sign in' %}
          </a>
        </div>

      </form>
    </div>

  </div>
</div>
{% endblock %}


{% block body_custom_js %}
<script>
  document.addEventListener('click', function (e) {
    const btn = e.target.closest('.toggle-visibility');
    if (!btn) return;

    const targetSelector = btn.getAttribute('data-target');
    if (!targetSelector) return;

    const input = document.querySelector(targetSelector);
    if (!input) return;

    const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
    input.setAttribute('type', type);

    const icon = btn.querySelector('i');
    if (icon) {
      icon.classList.toggle('bi-eye');
      icon.classList.toggle('bi-eye-slash');
    }
  });
</script>
{% endblock body_custom_js %}