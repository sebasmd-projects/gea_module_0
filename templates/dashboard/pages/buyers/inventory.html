{% extends 'dashboard/dashboard_layout_base.html' %}

{% load i18n static custom_filters humanize %}

{% block simple_datatables %}
  <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
{% endblock %}

{% block simple_datatables_js %}
  <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js" crossorigin="anonymous"></script>
  <script src="{% static 'js/simple-datatable.js' %}"></script>
{% endblock %}

{% block icons %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/aa367a5aee.js" crossorigin="anonymous"></script>
{% endblock %}

{% block main_layout %}
  {# ===== URLs y assets reutilizables ===== #}
  {% url 'buyers:buyer_index' as purchase_orders_url %}
  {% url 'buyers:buyer_create' as add_purchase_order_url %}
  {% url 'assets:create' as add_asset_url %}

  {% static 'assets/imgs/illustrations/statistics.svg' as purchase_orders_image %}
  {% static 'assets/imgs/illustrations/windows.svg' as add_new_purchase_order_image %}
  {% static 'assets/imgs/illustrations/browser-stats.svg' as add_asset_image %}

  {% trans 'Purchase orders' as purchase_orders %}
  {% trans 'Add new purchase order' as add_new_purchase_order %}
  {% trans 'Add new asset' as add_new_asset %}
  {% trans 'Inventory' as inventory %}
  {% trans 'Summary of movements and states' as summary_movements_states %}

  {% include 'dashboard/partials/header/_header.html' with icon_class='me-2 fa-solid fa-boxes-stacked' page_title=inventory page_description=summary_movements_states parent_title=purchase_orders parent_url=purchase_orders_url %}

  <!-- Main page content -->
  <div class="container-xl px-4 mt-n10">
    <div class="row">
      {% include 'dashboard/partials/header/_header_card.html' with icon_class='feather-xl text-green mb-3' icon_data_feather='file-text' page_header_title=purchase_orders page_header_image=purchase_orders_image url=purchase_orders_url %}
      {% include 'dashboard/partials/header/_header_card.html' with icon_class='feather-xl text-green mb-3' icon_data_feather='file-plus' page_header_title=add_new_purchase_order page_header_image=add_new_purchase_order_image url=add_purchase_order_url %}
      {% include 'dashboard/partials/header/_header_card.html' with icon_class='feather-xl text-green mb-3' icon_data_feather='archive' page_header_title=add_new_asset page_header_image=add_asset_image url=add_asset_url %}
    </div>

    <div class="row">
      <div class="col-md-12 mb-4">
        <div class="card">
          <div class="card-header" style="background-image: linear-gradient(to bottom, #c79c44 0%, #c89d46 50%, #f4d88b 100%);">
            <h2 class="text-black">{% trans 'Inventory by Category' %}</h2>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table id="tblByCategory" class="display table table-striped w-100">
                <thead>
                  <tr>
                    <th>{% trans 'Category' %}</th>
                    <th>{% trans 'Total quantity' %}</th>
                    <th>{% trans 'Description' %}</th>
                  </tr>
                </thead>
                <tbody>
                  {% for row in category_rows %}
                    <tr>
                      <td>{{ row.category }}</td>
                      <td data-order="{{ row.total_qty }}"><span class="format_number" data-value="{{ row.total_qty }}">{{ row.total_qty|intcomma }}</span></td>
                      <td>{{ row.description|default:"" }}</td>
                    </tr>
                  {% empty %}
                    <tr><td colspan="3" class="text-center text-muted py-4">{% trans 'No data available' %}</td></tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          <!-- <div class="card-footer">
            <div class="row">
              <div class="col-6">
              <button class="btn btn-outline-success" type="button"><i class="fa-solid fa-download mx-1"></i> {% trans 'Download Report' %} <i class="fa-solid fa-file-pdf mx-1"></i></button>
            </div>
            <div class="col-6">
              <button class="btn btn-outline-success" type="button"><i class="fa-solid fa-download mx-1"></i> {% trans 'Download Inventory by Category' %} <i class="fa-solid fa-file-csv mx-1"></i></button>
            </div>
            </div>
          </div> -->
        </div>
      </div>

      <div class="col-md-12">
        <div class="card mb-4">
          <div class="card-header" style="background-image: linear-gradient(to bottom, #c79c44 0%, #c89d46 50%, #f4d88b 100%);">
            <h2 class="text-black">{% trans 'Inventory' %}</h2>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table id="tblInventory" class="display table table-striped w-100">
                <thead>
                  <tr>
                    <th>{% trans 'Asset' %}</th>
                    <th>{% trans 'Category' %}</th>
                    <th>{% trans 'Units' %}</th>
                    <th>{% trans 'Boxes' %}</th>
                    <th>{% trans 'Total' %}</th>
                    <th>{% trans 'Description' %}</th>
                  </tr>
                </thead>
                <tbody>
                  {% for a in asset_rows %}
                    <tr>
                      <td>{{ a.name }}</td>
                      <td>{{ a.category }}</td>
                      <td data-order="{{ a.units }}"><span class="format_number" data-value="{{ a.units }}">{{ a.units|intcomma }}</span></td>
                      <td data-order="{{ a.boxes }}"><span class="format_number" data-value="{{ a.boxes }}">{{ a.boxes|intcomma }}</span></td>
                      <td data-order="{{ a.total }}"><span class="format_number" data-value="{{ a.total }}">{{ a.total|intcomma }}</span></td>
                      <td>{{ a.description|default:"" }}</td>
                    </tr>
                  {% empty %}
                    <tr><td colspan="6" class="text-center text-muted py-4">{% trans 'No data available' %}</td></tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          <!-- <div class="card-footer">
            <div class="row">
              <div class="col-6">
              <button class="btn btn-outline-success" type="button"><i class="fa-solid fa-download mx-1"></i> {% trans 'Download Report' %} <i class="fa-solid fa-file-pdf mx-1"></i></button>
            </div>
            <div class="col-6">
              <button class="btn btn-outline-success" type="button"><i class="fa-solid fa-download mx-1"></i> {% trans 'Download Inventory' %} <i class="fa-solid fa-file-csv mx-1"></i></button>
            </div>
            </div>
          </div> -->
        </div>
      </div>

    </div>
  </div>
{% endblock %}

{% block body_custom_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const locale = 'es';
  document.querySelectorAll('span.format_number').forEach(el => {
    const raw = el.dataset.value ?? el.textContent;
    const n = parseInt(raw, 10);
    if (!Number.isNaN(n)) { 
      el.textContent = n.toLocaleString(locale);
    }
  });
});
</script>
{% endblock %}
 