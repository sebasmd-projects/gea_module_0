{% extends 'account/layout/account.html' %}

{% load static i18n %}

{% block icons %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js"
  crossorigin="anonymous"></script>
<script src="https://kit.fontawesome.com/aa367a5aee.js" crossorigin="anonymous"></script>
{% endblock %}

{% block layout_content %}
<div class="d-flex align-items-center justify-content-center container-xl vh-100">
  <div class="card mx-auto" style="max-width: 600px; width: 100%;">
    <div class="card-header text-center">
      <a href="{% url 'core:index' %}">
        <img src="https://globalallianceusa.com/gea/public/static/assets/imgs/logos/gea_logo_gold.webp"
          class="card-img-top img-fluid" alt="GEA" />
      </a>
    </div>

    <div class="card-body">
      <form method="POST">
        {{ form.media.css }}
        
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ next }}" />

        <!-- Display non-field errors -->
        {% if form.non_field_errors %}
        <div class="alert alert-danger" role="alert">
          {% for error in form.non_field_errors %}
          <p>{{ error }}</p>
          {% endfor %}
        </div>
        {% endif %}

        <div class="row g-1">
          {% with "account/partials/_floating_input.html" as floating_input %}
          <div class="col-md-6">
            {% include floating_input with field=form.username label=_("Username") %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.email label=_("Email") %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.password label=_("Password") show_eye=True eye_target_id="register_password" %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.confirm_password label=_("Confirm Password") show_eye=True eye_target_id="register_confirm_password" %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.first_name label=_("First Names") %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.last_name label=_("Last Names") %}
          </div>

          <div class="col-md-6">
            {% include "account/partials/_floating_input.html" with field=form.phone_number_code %}
          </div>
          
          <div class="col-md-6">
            {% include "account/partials/_floating_input.html" with field=form.phone_number label=_("Cellphone") %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.user_type label=_("User Type") %}
          </div>

          <div class="col-md-6">
            {% include floating_input with field=form.unique_code label=_("Unique Code") show_eye=True eye_target_id="register_unique_code" %}
          </div>

          <div class="col-12">
            {# 1) Cuerpo del correo traducido y luego URL-encode #}
            {% blocktrans asvar mail_body %}
            Please complete the following information:

            First Names*:
            Last Names*:
            Cellphone*:

            If you do not provide this information, we will not be able to generate your unique code.
            {% endblocktrans %}

            {# 2) Asunto del correo (opcional usar asvar) #}
            {% blocktrans asvar mail_subject %}Request for unique code – GEA{% endblocktrans %}

            {# 3) Mensaje de WhatsApp en español (como pediste antes) y luego URL-encode #}
            {% blocktrans asvar wa_body_es %}Hello, I would like to request the unique code to register with GEA.{% endblocktrans %}

            <div class="form-text text-black size-14">
              {% trans 'You must request your unique registration code through' %}<br/>
              <a href="https://wa.me/573012283818?text={{ wa_body_es|urlencode }}" target="_blank">
                <i class="mx-1 fa-solid fa-headset"></i><i class="mx-1 fa-brands fa-whatsapp text-green"></i> 
                <span style="font-size: 20px;">WhatsApp: +57 301 228 38 18</span>
              </a>
              <br/>
              <a href="mailto:info@globalallianceusa.com?subject={{ mail_subject|urlencode }}&body={{ mail_body|urlencode }}">
                <span style="font-size: 15px;">info@globalallianceusa.com</span>
              </a>
            </div>
          </div>
          {% endwith %}
        </div>

        <div class="d-grid gap-2 mt-2">
          <button type="submit" class="btn btn-success">{% trans 'Register' %}</button>
          <a class="btn btn-outline-dark" href="{% url 'two_factor:login' %}">
            {% trans 'Do you already have an account? Sign in' %}
          </a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block body_custom_js %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<script>
  document.addEventListener('click', function (e) {
    const btn = e.target.closest('.toggle-visibility');
    if (!btn) return;

    const targetSelector = btn.getAttribute('data-target');
    if (!targetSelector) return;

    const input = document.querySelector(targetSelector);
    if (!input) return;

    const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
    input.setAttribute('type', type);

    const icon = btn.querySelector('i');
    if (icon) {
      icon.classList.toggle('bi-eye');
      icon.classList.toggle('bi-eye-slash');
    }
  });
</script>

{{ form.media.js }}
{% endblock body_custom_js %}