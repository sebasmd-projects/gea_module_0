{% extends "raw.html" %}
{% load static i18n %}

{% block title %}<title>{% trans "Asset Video Gallery" %}</title>{% endblock title %}

{% block content %}
<section class="container py-4 py-md-5">
  <div class="d-flex flex-column flex-md-row align-items-md-end justify-content-between gap-2 mb-3">
    <div>
      <h1 class="h3 mb-1">{% trans "Gallery" %}</h1>
      <p class="text-muted mb-0">{% trans "Multimedia content layout." %}</p>
    </div>
    <div class="small text-muted">{{ total_items }} {% trans "files" %}</div>
  </div>

  <div id="masonry" class="masonry">
    {% include "video_masonry/_media_grid.html" with items=items %}
  </div>

  <nav class="d-flex justify-content-center gap-2 mt-4" aria-label="Pagination">
    {% if has_prev %}
      <a class="btn btn-outline-secondary" href="?page={{ prev_page }}">{% trans "Previous" %}</a>
    {% else %}
      <button class="btn btn-outline-secondary" disabled>{% trans "Previous" %}</button>
    {% endif %}

    <span class="align-self-center small text-muted">
      {% trans "Page" %} {{ page }}
    </span>

    {% if has_next %}
      <a class="btn btn-outline-secondary" href="?page={{ next_page }}">{% trans "Next" %}</a>
    {% else %}
      <button class="btn btn-outline-secondary" disabled>{% trans "Next" %}</button>
    {% endif %}
  </nav>
</section>

<style>
  .masonry{ column-gap: 1rem; column-count: 1; }
  @media (min-width: 576px){ .masonry{ column-count: 2; } }
  @media (min-width: 992px){ .masonry{ column-count: 3; } }
  @media (min-width: 1400px){ .masonry{ column-count: 4; } }

  .masonry-item{
    display:inline-block; width:100%;
    margin:0 0 1rem; break-inside:avoid;
    border-radius:1rem;
  }

  .media-thumb{ width:100%; height:auto; display:block; }
  .media-caption{ font-size:.85rem; color:rgba(0,0,0,.55); }
</style>

<script>
(() => {
  const titleEl = document.getElementById("viewerTitle");
  const imgEl = document.getElementById("viewerImg");
  const vidEl = document.getElementById("viewerVid");

  function getCookie(name) {
    const v = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
    return v ? v.pop() : '';
  }
  const csrftoken = getCookie("csrftoken");

  async function trackView(assetId){
    try{
      const form = new FormData();
      form.append("asset_id", String(assetId));
      const res = await fetch("{% url 'video_masonry:track' %}", {
        method: "POST",
        headers: { "X-CSRFToken": csrftoken, "X-Requested-With": "XMLHttpRequest" },
        body: form
      });
      // si falla, no rompemos UX
      await res.json().catch(()=>null);
    }catch(e){}
  }

  

})();
</script>
{% endblock content %}
